import{_ as w,G as m,o as d,c as _,a as s,t as l,F as x,b as n,w as S,H as y,I as k,J as B,h as I,p as z,f as L,K as P}from"./index-D-XvNmkW.js";import{_ as h}from"./monitor-faults-DDVJoldT.js";import{d as E,g as T,a as C}from"./server-C2qe13OZ.js";/* empty css                  */function v(t){if(!t)return"0B";var c=Math.floor(Math.log(t)/Math.log(1024)),i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];return parseFloat((t/Math.pow(1024,c)).toFixed(2))+i[c]}function F(t){const c=v(t);return c!="NaN undefined"?c:"0B"}function N(t,c){return parseInt(c/t*100)||0}const M={readableBytes:v,formatByteSize:F,formatPercent:N},D={computed:{help(){return M}},components:{MonitorFaults:h,ServerStatisticsBar:m},data(){return{total:[],server:null,serverId:null,serverStatisticsType:3,colors:[{color:"#5cb87a",percentage:50},{color:"#e6a23c",percentage:80},{color:"#f56c6c",percentage:100}],ws:null}},watch:{"$route.params.id"(){this.serverId=this.$route.params.id,this.getServerInfo(this.serverId),this.getServerStatisticsList(this.serverId),this.$bus.emit("serverSelect",this.serverId)}},mounted(){this.serverId=this.$route.params.id,this.getServerInfo(this.serverId),this.getServerStatisticsList(this.serverId),this.$bus.emit("serverSelect",this.serverId),this.registerServerListen()},unmounted(){if(this.$bus.emit("serverSelect",null),this.ws){let t=this.ws;this.ws=null,t.close()}},methods:{handleEdit(t){this.$router.push(`/server/edit/${t}`)},handleDelete(t){this.$confirm("此操作将永久删除该服务器, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{E(t).then(()=>{this.$message({type:"success",message:"删除成功!"}),this.$bus.emit("serverChanged"),this.$router.go(-1)}).catch(c=>{this.$message({type:"error",message:"删除失败!"+c})})}).catch(()=>{})},getServerInfo(t){T(t).then(c=>{this.server=c})},getServerStatisticsList(t){C(t,this.serverStatisticsType).then(c=>{this.total=c})},registerServerListen(){this.ws=new WebSocket("/ws/web"),this.ws.addEventListener("message",t=>{let c=JSON.parse(t.data),i=JSON.parse(c.message);console.log("Message from server ",c.message_type,i),c.message_type===5e3?i.server_id==this.serverId&&(this.server.status=1,this.server.server_info=i.server_info,this.server.server_state=i.server_state):c.message_type===5001?i==this.serverId&&(this.server.status=0):c.message_type===5002&&i.server_id==this.serverId&&(console.log("Server state update: ",i),this.server.server_state=i)}),this.ws.addEventListener("close",t=>{console.log("Server connection closed: ",t),this.ws!=null&&(this.$message({type:"error",message:"服务器连接已断开，正在重新链接!"}),setTimeout(()=>{this.registerServerListen()},1e3))})}}},o=t=>(z("data-v-c80fbc64"),t=t(),L(),t),V={key:0,class:"server"},J={class:"mb-3"},U={class:"mb-3"},G={class:"functions mb-3"},K={class:"btn-group",role:"group"},O=o(()=>s("button",{class:"btn btn-normal"}," 安装脚本 ",-1)),j={class:"shadow-box mb-3"},H={class:"row"},W={class:"col-md-8"},Y={class:"wrap",style:{padding:"7.5px 2.6px",width:"100%"}},Z=o(()=>s("span",{class:"word"},"最近30天",-1)),q={class:"col-md-4 text-center"},A={key:0,class:"badge rounded-pill bg-primary",style:{"font-size":"30px"}},Q={key:1,class:"badge rounded-pill bg-danger",style:{"font-size":"30px"}},R={class:"shadow-box big-padding text-center stats mb-3"},X={class:"row"},$={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ss=o(()=>s("h4",{class:"col-4 col-sm-12"},"IP",-1)),es=o(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," 当前 ",-1)),os={class:"col-4 col-sm-12 num"},ts={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},cs=o(()=>s("h4",{class:"col-4 col-sm-12"},"系统",-1)),ls=o(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," os ",-1)),rs={class:"col-4 col-sm-12 num"},is={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ns=o(()=>s("h4",{class:"col-4 col-sm-12"},"系统型号",-1)),ds=o(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," platform ",-1)),_s={class:"col-4 col-sm-12 num"},as={class:"shadow-box big-padding text-center stats mb-3"},ms={class:"row"},hs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},vs=o(()=>s("h4",{class:"col-4 col-sm-12"},"CPU型号",-1)),ps=o(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," cpu ",-1)),us={class:"col-4 col-sm-12 num"},fs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},bs=o(()=>s("h4",{class:"col-4 col-sm-12"},"虚拟化",-1)),gs=o(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," virtualization ",-1)),ws={class:"col-4 col-sm-12 num"},xs={class:""},Ss={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ys=o(()=>s("h4",{class:"col-4 col-sm-12"},"最后在线时间",-1)),ks=o(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," Last online ",-1)),Bs={class:"col-4 col-sm-12 num"},Is={class:""},zs={class:"row"},Ls={class:"col-md-6"},Ps={class:"shadow-box mb-3"},Es={style:{display:"flex","justify-content":"space-between"}},Ts=o(()=>s("h4",{class:"mb-3"},"CPU Load",-1)),Cs={class:"desc"},Fs={class:"text-center mb-5"},Ns={class:"row mb-3"},Ms={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ds=o(()=>s("div",{class:"col-6 col-sm-12"},"Load1",-1)),Vs={class:"col-6 col-sm-12 num desc"},Js={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Us=o(()=>s("div",{class:"col-6 col-sm-12"},"Load5",-1)),Gs={class:"col-6 col-sm-12 num desc"},Ks={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Os=o(()=>s("div",{class:"col-6 col-sm-12"},"Load15",-1)),js={class:"col-6 col-sm-12 num desc"},Hs={class:"row"},Ws={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ys=o(()=>s("div",{class:"col-6 col-sm-12"},"TCP连接数",-1)),Zs={class:"col-6 col-sm-12 num desc"},qs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},As=o(()=>s("div",{class:"col-6 col-sm-12"},"UDP连接数",-1)),Qs={class:"col-6 col-sm-12 num desc"},Rs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Xs=o(()=>s("div",{class:"col-6 col-sm-12"},"进程数",-1)),$s={class:"col-6 col-sm-12 num desc"},se={class:"col-md-6"},ee={class:"shadow-box mb-3"},oe=o(()=>s("h4",{class:"mb-3"},"内存",-1)),te={class:"mb-3"},ce={class:"row"},le={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},re=o(()=>s("div",{class:"col-6 col-sm-12"},"内存大小",-1)),ie={class:"col-6 col-sm-12 num desc"},ne={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},de=o(()=>s("div",{class:"col-6 col-sm-12"},"内存占用",-1)),_e={class:"col-6 col-sm-12 num desc"},ae={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},me=o(()=>s("div",{class:"col-6 col-sm-12"},"交换分区大小",-1)),he={class:"col-6 col-sm-12 num desc"},ve={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},pe=o(()=>s("div",{class:"col-6 col-sm-12"},"交换分区占用",-1)),ue={class:"col-6 col-sm-12 num desc"},fe={class:"shadow-box mb-3"},be=o(()=>s("h4",{class:"mb-3"},"磁盘",-1)),ge={class:"mb-3"},we={class:"shadow-box mb-3"},xe=o(()=>s("h4",{class:"mb-3"},"网络",-1)),Se={class:"row"},ye={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ke=o(()=>s("div",{class:"col-6 col-sm-12"},"入站速度",-1)),Be={class:"col-6 col-sm-12 desc"},Ie={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ze=o(()=>s("div",{class:"col-6 col-sm-12"},"出站速度",-1)),Le={class:"col-6 col-sm-12 desc"},Pe={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ee=o(()=>s("div",{class:"col-6 col-sm-12"},"入站流量",-1)),Te={class:"col-6 col-sm-12 desc"},Ce={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Fe=o(()=>s("div",{class:"col-6 col-sm-12"},"出站流量",-1)),Ne={class:"col-6 col-sm-12 desc"},Me={class:"shadow-box mb-3"},De={key:1,class:"shadow-box"};function Ve(t,c,i,Je,e,r){const p=m,u=k,a=B,f=h,b=P;return e.server?(d(),_("div",V,[s("h1",J,l(e.server.name),1),s("div",U,l(e.server.remark),1),s("div",G,[s("div",K,[s("button",{class:"btn btn-normal",onClick:c[0]||(c[0]=g=>r.handleEdit(e.server.id)),style:{"border-radius":"30px 0 0 30px"}}," 编辑 "),O,s("button",{class:"btn btn-danger",onClick:c[1]||(c[1]=g=>r.handleDelete(e.server.id)),style:{"border-radius":"0 30px 30px 0"}}," 删除 ")])]),e.server.server_info?(d(),_(x,{key:0},[s("div",j,[s("div",H,[s("div",W,[s("div",Y,[n(p,{width:10,height:30,total:e.total},null,8,["total"])]),Z]),s("div",q,[e.server.status===1?(d(),_("span",A," 在线 ")):(d(),_("span",Q," 离线 "))])])]),s("div",R,[s("div",X,[s("div",$,[ss,es,s("span",os,l(e.server.ip),1)]),s("div",ts,[cs,ls,s("span",rs,l(e.server.server_info.os),1)]),s("div",is,[ns,ds,s("span",_s,l(e.server.server_info.platform),1)])])]),s("div",as,[s("div",ms,[s("div",hs,[vs,ps,s("span",us,[n(u,{"line-clamp":"1",title:e.server.server_info.cpu},{default:S(()=>[I(l(e.server.server_info.cpu),1)]),_:1},8,["title"])])]),s("div",fs,[bs,gs,s("span",ws,[s("span",xs,l(e.server.server_info.virtualization),1)])]),s("div",Ss,[ys,ks,s("span",Bs,[s("span",Is,l(e.server.last_online_time),1)])])])]),s("div",zs,[s("div",Ls,[s("div",Ps,[s("div",Es,[Ts,s("span",Cs,"最后更新于："+l(e.server.server_state.update_time),1)]),s("div",Fs,[n(a,{type:"dashboard","stroke-width":20,width:200,striped:"","striped-flow":"",percentage:r.help.formatPercent(100,e.server.server_state.cpu),color:e.colors},null,8,["percentage","color"])]),s("div",Ns,[s("div",Ms,[Ds,s("span",Vs,l(e.server.server_state.load1.toFixed(2)),1)]),s("div",Js,[Us,s("span",Gs,l(e.server.server_state.load5.toFixed(2)),1)]),s("div",Ks,[Os,s("span",js,l(e.server.server_state.load15.toFixed(2)),1)])]),s("div",Hs,[s("div",Ws,[Ys,s("span",Zs,l(e.server.server_state.tcp_conn_count),1)]),s("div",qs,[As,s("span",Qs,l(e.server.server_state.udp_conn_count),1)]),s("div",Rs,[Xs,s("span",$s,l(e.server.server_state.process_count),1)])])])]),s("div",se,[s("div",ee,[oe,s("div",te,[n(a,{percentage:r.help.formatPercent(e.server.server_info.mem_total,e.server.server_state.mem_used),color:e.colors,striped:"","striped-flow":""},null,8,["percentage","color"])]),s("div",ce,[s("div",le,[re,s("span",ie,l(r.help.formatByteSize(e.server.server_info.mem_total)),1)]),s("div",ne,[de,s("span",_e,l(r.help.formatByteSize(e.server.server_state.mem_used)),1)]),s("div",ae,[me,s("span",he,l(r.help.formatByteSize(e.server.server_info.swap_total)),1)]),s("div",ve,[pe,s("span",ue,l(r.help.formatByteSize(e.server.server_state.swap_used)),1)])])]),s("div",fe,[be,s("div",ge,[n(a,{percentage:r.help.formatPercent(e.server.server_info.disk_total,e.server.server_state.disk_used),format:()=>r.help.formatByteSize(e.server.server_state.disk_used)+"/"+r.help.formatByteSize(e.server.server_info.disk_total),color:e.colors,striped:"","striped-flow":""},null,8,["percentage","format","color"])])]),s("div",we,[xe,s("div",Se,[s("div",ye,[ke,s("span",Be,l(r.help.formatByteSize(e.server.server_state.net_in_speed))+"/s ",1)]),s("div",Ie,[ze,s("span",Le,l(r.help.formatByteSize(e.server.server_state.net_out_speed))+"/s ",1)]),s("div",Pe,[Ee,s("span",Te,l(r.help.formatByteSize(e.server.server_state.net_in_transfer)),1)]),s("div",Ce,[Fe,s("span",Ne,l(r.help.formatByteSize(e.server.server_state.net_out_transfer)),1)])])])])]),s("div",Me,[n(f,{"server-id":e.serverId,limit:5},null,8,["server-id"])])],64)):(d(),_("div",De,[n(b,{description:"未安装"})]))])):y("",!0)}const je=w(D,[["render",Ve],["__scopeId","data-v-c80fbc64"]]);export{je as default};
