import{_ as w,H as v,u as x,o as d,c as _,a as s,t as o,F as S,b as n,w as y,I as k,J as I,K as B,h as z,p as L,f as C,D as P}from"./index-Cl6wgQ7c.js";/* empty css                 */import{M as p}from"./monitor-faults-DJLMmZ07.js";import{h as E}from"./help-DoMWFVUl.js";import{d as T,g as F,a as N}from"./server-BONhCzWF.js";/* empty css                  */const D={computed:{help(){return E}},components:{MonitorFaults:p,ServerStatisticsBar:v},data(){return{settingStore:x(),total:[],server:null,serverId:null,serverStatisticsType:3,colors:[{color:"#5cb87a",percentage:50},{color:"#e6a23c",percentage:80},{color:"#f56c6c",percentage:100}],ws:null}},watch:{"$route.params.id"(){this.serverId=this.$route.params.id,this.getServerInfo(this.serverId),this.getServerStatisticsList(this.serverId),this.$bus.emit("serverSelect",this.serverId)}},mounted(){this.serverId=this.$route.params.id,this.getServerInfo(this.serverId),this.getServerStatisticsList(this.serverId),this.$bus.emit("serverSelect",this.serverId),this.registerServerListen()},unmounted(){if(this.$bus.emit("serverSelect",null),this.ws){let c=this.ws;this.ws=null,c.close()}},methods:{handleEdit(c){this.$router.push(`/server/edit/${c}`)},handleDelete(c){this.$confirm("此操作将永久删除该服务器, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{T(c).then(()=>{this.$message({type:"success",message:"删除成功!"}),this.$bus.emit("serverChanged"),this.$router.go(-1)}).catch(l=>{this.$message({type:"error",message:"删除失败!"+l})})}).catch(()=>{})},getServerInfo(c){F(c).then(l=>{this.server=l})},getServerStatisticsList(c){N(c,this.serverStatisticsType).then(l=>{this.total=l})},registerServerListen(){this.ws=new WebSocket("/ws/web"),this.ws.addEventListener("message",c=>{let l=JSON.parse(c.data),i=JSON.parse(l.message);console.log("Message from server ",l.message_type,i),l.message_type===5e3?i.server_id==this.serverId&&(this.server.status=1,this.server.server_info=i.server_info,this.server.server_state=i.server_state):l.message_type===5001?i==this.serverId&&(this.server.status=0):l.message_type===5002&&i.server_id==this.serverId&&(console.log("Server state update: ",i),this.server.server_state=i)}),this.ws.addEventListener("close",c=>{console.log("Server connection closed: ",c),this.ws!=null&&(this.$message({type:"error",message:"服务器连接已断开，正在重新链接!"}),setTimeout(()=>{this.registerServerListen()},1e3))})},copyInstallScript(){let c=this.settingStore.setting.server_ip,l=this.settingStore.setting.server_port,i=this.server.key,a=`curl https://cdn.jsdelivr.net/gh/imblowsnow/server-monitor@master/deploy.sh | bash -s -- ${c} ${l} ${i}`;console.log(a);let e=document.createElement("input");e.value=a,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.$message({type:"success",message:"复制成功!"})}}},t=c=>(L("data-v-795c9adf"),c=c(),C(),c),V={key:0,class:"server"},J={class:"mb-3"},M={class:"mb-3"},U={class:"functions mb-3"},j={class:"btn-group",role:"group"},O={class:"shadow-box mb-3"},H={class:"row"},K={class:"col-md-8"},W={class:"wrap",style:{padding:"7.5px 2.6px",width:"100%"}},q=t(()=>s("span",{class:"word"},"最近30天",-1)),A={class:"col-md-4 text-center"},G={key:0,class:"badge rounded-pill bg-primary",style:{"font-size":"30px"}},Q={key:1,class:"badge rounded-pill bg-danger",style:{"font-size":"30px"}},R={class:"shadow-box big-padding text-center stats mb-3"},X={class:"row"},Y={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Z=t(()=>s("h4",{class:"col-4 col-sm-12"},"IP",-1)),$=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," 当前 ",-1)),ss={class:"col-4 col-sm-12 num"},es={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ts=t(()=>s("h4",{class:"col-4 col-sm-12"},"系统",-1)),os=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," os ",-1)),cs={class:"col-4 col-sm-12 num"},ls={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},rs=t(()=>s("h4",{class:"col-4 col-sm-12"},"系统型号",-1)),is=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," platform ",-1)),ns={class:"col-4 col-sm-12 num"},ds={class:"shadow-box big-padding text-center stats mb-3"},_s={class:"row"},as={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ms=t(()=>s("h4",{class:"col-4 col-sm-12"},"CPU型号",-1)),hs=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," cpu ",-1)),vs={class:"col-4 col-sm-12 num"},ps={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},us=t(()=>s("h4",{class:"col-4 col-sm-12"},"虚拟化",-1)),bs=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," virtualization ",-1)),fs={class:"col-4 col-sm-12 num"},gs={class:""},ws={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},xs=t(()=>s("h4",{class:"col-4 col-sm-12"},"最后在线时间",-1)),Ss=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," Last online ",-1)),ys={class:"col-4 col-sm-12 num"},ks={class:""},Is={class:"row"},Bs={class:"col-md-6"},zs={class:"shadow-box mb-3"},Ls={style:{display:"flex","justify-content":"space-between"}},Cs=t(()=>s("h4",{class:"mb-3"},"CPU Load",-1)),Ps={class:"desc"},Es={class:"text-center mb-5"},Ts={class:"row mb-3"},Fs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ns=t(()=>s("div",{class:"col-6 col-sm-12"},"Load1",-1)),Ds={class:"col-6 col-sm-12 num desc"},Vs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Js=t(()=>s("div",{class:"col-6 col-sm-12"},"Load5",-1)),Ms={class:"col-6 col-sm-12 num desc"},Us={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},js=t(()=>s("div",{class:"col-6 col-sm-12"},"Load15",-1)),Os={class:"col-6 col-sm-12 num desc"},Hs={class:"row"},Ks={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ws=t(()=>s("div",{class:"col-6 col-sm-12"},"TCP连接数",-1)),qs={class:"col-6 col-sm-12 num desc"},As={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Gs=t(()=>s("div",{class:"col-6 col-sm-12"},"UDP连接数",-1)),Qs={class:"col-6 col-sm-12 num desc"},Rs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Xs=t(()=>s("div",{class:"col-6 col-sm-12"},"进程数",-1)),Ys={class:"col-6 col-sm-12 num desc"},Zs={class:"col-md-6"},$s={class:"shadow-box mb-3"},se=t(()=>s("h4",{class:"mb-3"},"内存",-1)),ee={class:"mb-3"},te={class:"row"},oe={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ce=t(()=>s("div",{class:"col-6 col-sm-12"},"内存大小",-1)),le={class:"col-6 col-sm-12 num desc"},re={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ie=t(()=>s("div",{class:"col-6 col-sm-12"},"内存占用",-1)),ne={class:"col-6 col-sm-12 num desc"},de={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},_e=t(()=>s("div",{class:"col-6 col-sm-12"},"交换分区大小",-1)),ae={class:"col-6 col-sm-12 num desc"},me={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},he=t(()=>s("div",{class:"col-6 col-sm-12"},"交换分区占用",-1)),ve={class:"col-6 col-sm-12 num desc"},pe={class:"shadow-box mb-3"},ue=t(()=>s("h4",{class:"mb-3"},"磁盘",-1)),be={class:"mb-3"},fe={class:"shadow-box mb-3"},ge=t(()=>s("h4",{class:"mb-3"},"网络",-1)),we={class:"row"},xe={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Se=t(()=>s("div",{class:"col-6 col-sm-12"},"入站速度",-1)),ye={class:"col-6 col-sm-12 desc"},ke={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ie=t(()=>s("div",{class:"col-6 col-sm-12"},"出站速度",-1)),Be={class:"col-6 col-sm-12 desc"},ze={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Le=t(()=>s("div",{class:"col-6 col-sm-12"},"入站流量",-1)),Ce={class:"col-6 col-sm-12 desc"},Pe={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ee=t(()=>s("div",{class:"col-6 col-sm-12"},"出站流量",-1)),Te={class:"col-6 col-sm-12 desc"},Fe={class:"shadow-box mb-3"},Ne={key:1,class:"shadow-box"};function De(c,l,i,a,e,r){const u=v,b=I,m=B,f=p,g=P;return e.server?(d(),_("div",V,[s("h1",J,o(e.server.name),1),s("div",M,o(e.server.remark),1),s("div",U,[s("div",j,[s("button",{class:"btn btn-primary",onClick:l[0]||(l[0]=h=>r.handleEdit(e.server.id))}," 编辑 "),s("button",{class:"btn btn-primary",onClick:l[1]||(l[1]=(...h)=>r.copyInstallScript&&r.copyInstallScript(...h))}," 安装脚本 "),s("button",{class:"btn btn-danger",onClick:l[2]||(l[2]=h=>r.handleDelete(e.server.id))}," 删除 ")])]),e.server.server_info?(d(),_(S,{key:0},[s("div",O,[s("div",H,[s("div",K,[s("div",W,[n(u,{width:10,height:30,total:e.total},null,8,["total"])]),q]),s("div",A,[e.server.status===1?(d(),_("span",G," 在线 ")):(d(),_("span",Q," 离线 "))])])]),s("div",R,[s("div",X,[s("div",Y,[Z,$,s("span",ss,o(e.server.ip),1)]),s("div",es,[ts,os,s("span",cs,o(e.server.server_info.os),1)]),s("div",ls,[rs,is,s("span",ns,o(e.server.server_info.platform),1)])])]),s("div",ds,[s("div",_s,[s("div",as,[ms,hs,s("span",vs,[n(b,{"line-clamp":"1",title:e.server.server_info.cpu},{default:y(()=>[z(o(e.server.server_info.cpu),1)]),_:1},8,["title"])])]),s("div",ps,[us,bs,s("span",fs,[s("span",gs,o(e.server.server_info.virtualization),1)])]),s("div",ws,[xs,Ss,s("span",ys,[s("span",ks,o(e.server.last_online_time),1)])])])]),s("div",Is,[s("div",Bs,[s("div",zs,[s("div",Ls,[Cs,s("span",Ps,"最后更新于："+o(e.server.server_state.update_time),1)]),s("div",Es,[n(m,{type:"dashboard","stroke-width":20,width:200,striped:"","striped-flow":"",percentage:r.help.formatPercent(100,e.server.server_state.cpu),color:e.colors},null,8,["percentage","color"])]),s("div",Ts,[s("div",Fs,[Ns,s("span",Ds,o(e.server.server_state.load1.toFixed(2)),1)]),s("div",Vs,[Js,s("span",Ms,o(e.server.server_state.load5.toFixed(2)),1)]),s("div",Us,[js,s("span",Os,o(e.server.server_state.load15.toFixed(2)),1)])]),s("div",Hs,[s("div",Ks,[Ws,s("span",qs,o(e.server.server_state.tcp_conn_count),1)]),s("div",As,[Gs,s("span",Qs,o(e.server.server_state.udp_conn_count),1)]),s("div",Rs,[Xs,s("span",Ys,o(e.server.server_state.process_count),1)])])])]),s("div",Zs,[s("div",$s,[se,s("div",ee,[n(m,{percentage:r.help.formatPercent(e.server.server_info.mem_total,e.server.server_state.mem_used),color:e.colors,striped:"","striped-flow":""},null,8,["percentage","color"])]),s("div",te,[s("div",oe,[ce,s("span",le,o(r.help.formatByteSize(e.server.server_info.mem_total)),1)]),s("div",re,[ie,s("span",ne,o(r.help.formatByteSize(e.server.server_state.mem_used)),1)]),s("div",de,[_e,s("span",ae,o(r.help.formatByteSize(e.server.server_info.swap_total)),1)]),s("div",me,[he,s("span",ve,o(r.help.formatByteSize(e.server.server_state.swap_used)),1)])])]),s("div",pe,[ue,s("div",be,[n(m,{percentage:r.help.formatPercent(e.server.server_info.disk_total,e.server.server_state.disk_used),format:()=>r.help.formatByteSize(e.server.server_state.disk_used)+"/"+r.help.formatByteSize(e.server.server_info.disk_total),color:e.colors,striped:"","striped-flow":""},null,8,["percentage","format","color"])])]),s("div",fe,[ge,s("div",we,[s("div",xe,[Se,s("span",ye,o(r.help.formatByteSize(e.server.server_state.net_in_speed))+"/s ",1)]),s("div",ke,[Ie,s("span",Be,o(r.help.formatByteSize(e.server.server_state.net_out_speed))+"/s ",1)]),s("div",ze,[Le,s("span",Ce,o(r.help.formatByteSize(e.server.server_state.net_in_transfer)),1)]),s("div",Pe,[Ee,s("span",Te,o(r.help.formatByteSize(e.server.server_state.net_out_transfer)),1)])])])])]),s("div",Fe,[n(f,{"server-id":e.serverId,limit:5},null,8,["server-id"])])],64)):(d(),_("div",Ne,[n(g,{description:"未安装"})]))])):k("",!0)}const He=w(D,[["render",De],["__scopeId","data-v-795c9adf"]]);export{He as default};
