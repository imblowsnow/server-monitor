import{_ as w,H as v,u as x,o as _,c as a,a as s,t as o,F as S,b as n,w as y,I as k,J as I,K as B,h as z,p as C,f as L,D as P}from"./index-GT17-lK8.js";/* empty css                 */import{M as p}from"./monitor-faults-rGZGJ-uV.js";import{h as E}from"./help-DoMWFVUl.js";import{d as T,g as U,a as F,c as N}from"./server-BP7FDecQ.js";/* empty css                  */const V={computed:{help(){return E}},components:{MonitorFaults:p,ServerStatisticsBar:v},data(){return{settingStore:x(),total:[],server:null,serverId:null,serverStatisticsType:3,colors:[{color:"#5cb87a",percentage:50},{color:"#e6a23c",percentage:80},{color:"#f56c6c",percentage:100}],ws:null}},watch:{"$route.params.id"(){this.serverId=this.$route.params.id,this.getServerInfo(this.serverId),this.getServerStatisticsList(this.serverId),this.$bus.emit("serverSelect",this.serverId)}},mounted(){this.serverId=this.$route.params.id,this.getServerInfo(this.serverId),this.getServerStatisticsList(this.serverId),this.$bus.emit("serverSelect",this.serverId),this.registerServerListen()},unmounted(){if(this.$bus.emit("serverSelect",null),this.ws){let c=this.ws;this.ws=null,c.close()}},methods:{handleEdit(c){this.$router.push(`/server/edit/${c}`)},handleDelete(c){this.$confirm("此操作将永久删除该服务器, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{T(c).then(()=>{this.$message({type:"success",message:"删除成功!"}),this.$bus.emit("serverChanged"),this.$router.go(-1)}).catch(l=>{this.$message({type:"error",message:"删除失败!"+l})})}).catch(()=>{})},getServerInfo(c){U(c).then(l=>{this.server=l})},getServerStatisticsList(c){F(c,this.serverStatisticsType).then(l=>{this.total=l})},registerServerListen(){this.ws=new WebSocket("/ws/web"),this.ws.addEventListener("message",c=>{let l=JSON.parse(c.data),i=JSON.parse(l.message);console.log("Message from server ",l.message_type,i),l.message_type===5e3?i.server_id==this.serverId&&(this.server.status=1,this.server.server_info=i.server_info,this.server.server_state=i.server_state):l.message_type===5001?i==this.serverId&&(this.server.status=0):l.message_type===5002&&i.server_id==this.serverId&&(console.log("Server state update: ",i),this.server.server_state=i)}),this.ws.addEventListener("close",c=>{console.log("Server connection closed: ",c),this.ws!=null&&(this.$message({type:"error",message:"服务器连接已断开，正在重新链接!"}),setTimeout(()=>{this.registerServerListen()},1e3))})},copyInstallScript(){let c=this.settingStore.setting.server_ip,l=this.settingStore.setting.server_port,i=this.server.key,m=`curl https://cdn.jsdelivr.net/gh/imblowsnow/server-monitor@master/deploy.sh | bash -s -- ${c} ${l} ${i}`;console.log(m);let e=document.createElement("input");e.value=m,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.$message({type:"success",message:"复制成功!"})},checkUpdate(){N(this.serverId).then(()=>{this.$message({type:"success",message:"推送更新成功!"})}).catch(c=>{this.$message({type:"error",message:"推送更新失败!"+c})})}}},t=c=>(C("data-v-de77a4d9"),c=c(),L(),c),D={key:0,class:"server"},J={class:"mb-3"},M={class:"mb-3"},O={class:"functions mb-3"},j={class:"btn-group",role:"group"},H={class:"shadow-box mb-3"},K={class:"row"},W={class:"col-md-8"},q={class:"wrap",style:{padding:"7.5px 2.6px",width:"100%"}},A=t(()=>s("span",{class:"desc"},"最近30天",-1)),G={class:"col-md-4 text-center"},Q={key:0,class:"badge rounded-pill bg-primary",style:{"font-size":"30px"}},R={key:1,class:"badge rounded-pill bg-danger",style:{"font-size":"30px"}},X={class:"shadow-box big-padding text-center stats mb-3"},Y={class:"row"},Z={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},$=t(()=>s("h4",{class:"col-4 col-sm-12"},"IP",-1)),ss=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," Ip ",-1)),es={class:"col-4 col-sm-12 num"},ts={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},os=t(()=>s("h4",{class:"col-4 col-sm-12"},"系统",-1)),cs=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," OS ",-1)),ls={class:"col-4 col-sm-12 num"},rs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},is=t(()=>s("h4",{class:"col-4 col-sm-12"},"系统型号",-1)),ns=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," Platform ",-1)),ds={class:"col-4 col-sm-12 num"},_s={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},as=t(()=>s("h4",{class:"col-4 col-sm-12"},"应用版本",-1)),ms=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," Version ",-1)),hs={class:"col-4 col-sm-12 num"},vs={class:"shadow-box big-padding text-center stats mb-3"},ps={class:"row"},us={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},bs=t(()=>s("h4",{class:"col-4 col-sm-12"},"CPU型号",-1)),gs=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," Cpu ",-1)),fs={class:"col-4 col-sm-12 num"},ws={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},xs=t(()=>s("h4",{class:"col-4 col-sm-12"},"虚拟化",-1)),Ss=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," Virtualization ",-1)),ys={class:"col-4 col-sm-12 num"},ks={class:""},Is={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Bs=t(()=>s("h4",{class:"col-4 col-sm-12"},"最后在线时间",-1)),zs=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," Last online ",-1)),Cs={class:"col-4 col-sm-12 num"},Ls={class:""},Ps={class:"row"},Es={class:"col-md-6"},Ts={class:"shadow-box mb-3"},Us={style:{display:"flex","justify-content":"space-between"}},Fs=t(()=>s("h4",{class:"mb-3"},"CPU Load",-1)),Ns={class:"desc"},Vs={class:"text-center mb-5"},Ds={class:"row mb-3"},Js={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ms=t(()=>s("div",{class:"col-6 col-sm-12"},"Load1",-1)),Os={class:"col-6 col-sm-12 num desc"},js={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Hs=t(()=>s("div",{class:"col-6 col-sm-12"},"Load5",-1)),Ks={class:"col-6 col-sm-12 num desc"},Ws={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},qs=t(()=>s("div",{class:"col-6 col-sm-12"},"Load15",-1)),As={class:"col-6 col-sm-12 num desc"},Gs={class:"row"},Qs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Rs=t(()=>s("div",{class:"col-6 col-sm-12"},"TCP连接数",-1)),Xs={class:"col-6 col-sm-12 num desc"},Ys={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Zs=t(()=>s("div",{class:"col-6 col-sm-12"},"UDP连接数",-1)),$s={class:"col-6 col-sm-12 num desc"},se={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ee=t(()=>s("div",{class:"col-6 col-sm-12"},"进程数",-1)),te={class:"col-6 col-sm-12 num desc"},oe={class:"col-md-6"},ce={class:"shadow-box mb-3"},le=t(()=>s("h4",{class:"mb-3"},"内存",-1)),re={class:"mb-3"},ie={class:"row"},ne={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},de=t(()=>s("div",{class:"col-6 col-sm-12"},"内存大小",-1)),_e={class:"col-6 col-sm-12 num desc"},ae={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},me=t(()=>s("div",{class:"col-6 col-sm-12"},"内存占用",-1)),he={class:"col-6 col-sm-12 num desc"},ve={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},pe=t(()=>s("div",{class:"col-6 col-sm-12"},"交换分区大小",-1)),ue={class:"col-6 col-sm-12 num desc"},be={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ge=t(()=>s("div",{class:"col-6 col-sm-12"},"交换分区占用",-1)),fe={class:"col-6 col-sm-12 num desc"},we={class:"shadow-box mb-3"},xe=t(()=>s("h4",{class:"mb-3"},"磁盘",-1)),Se={class:"mb-3"},ye={class:"shadow-box mb-3"},ke=t(()=>s("h4",{class:"mb-3"},"网络",-1)),Ie={class:"row"},Be={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ze=t(()=>s("div",{class:"col-6 col-sm-12"},"入站速度",-1)),Ce={class:"col-6 col-sm-12 desc"},Le={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Pe=t(()=>s("div",{class:"col-6 col-sm-12"},"出站速度",-1)),Ee={class:"col-6 col-sm-12 desc"},Te={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ue=t(()=>s("div",{class:"col-6 col-sm-12"},"入站流量",-1)),Fe={class:"col-6 col-sm-12 desc"},Ne={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ve=t(()=>s("div",{class:"col-6 col-sm-12"},"出站流量",-1)),De={class:"col-6 col-sm-12 desc"},Je={class:"shadow-box mb-3"},Me={key:1,class:"shadow-box"};function Oe(c,l,i,m,e,r){const u=v,b=I,h=B,g=p,f=P;return e.server?(_(),a("div",D,[s("h1",J,o(e.server.name),1),s("div",M,o(e.server.remark),1),s("div",O,[s("div",j,[s("button",{class:"btn btn-primary",onClick:l[0]||(l[0]=d=>r.handleEdit(e.server.id))}," 编辑 "),s("button",{class:"btn btn-primary",onClick:l[1]||(l[1]=(...d)=>r.copyInstallScript&&r.copyInstallScript(...d))}," 安装脚本 "),s("button",{class:"btn btn-primary",onClick:l[2]||(l[2]=(...d)=>r.checkUpdate&&r.checkUpdate(...d))}," 检查更新 "),s("button",{class:"btn btn-danger",onClick:l[3]||(l[3]=d=>r.handleDelete(e.server.id))}," 删除 ")])]),e.server.server_info?(_(),a(S,{key:0},[s("div",H,[s("div",K,[s("div",W,[s("div",q,[n(u,{width:10,height:30,total:e.total},null,8,["total"])]),A]),s("div",G,[e.server.status===1?(_(),a("span",Q," 在线 ")):(_(),a("span",R," 离线 "))])])]),s("div",X,[s("div",Y,[s("div",Z,[$,ss,s("span",es,o(e.server.ip),1)]),s("div",ts,[os,cs,s("span",ls,o(e.server.server_info.os),1)]),s("div",rs,[is,ns,s("span",ds,o(e.server.server_info.platform),1)]),s("div",_s,[as,ms,s("span",hs,o(e.server.server_info.version),1)])])]),s("div",vs,[s("div",ps,[s("div",us,[bs,gs,s("span",fs,[n(b,{"line-clamp":"1",title:e.server.server_info.cpu},{default:y(()=>[z(o(e.server.server_info.cpu),1)]),_:1},8,["title"])])]),s("div",ws,[xs,Ss,s("span",ys,[s("span",ks,o(e.server.server_info.virtualization),1)])]),s("div",Is,[Bs,zs,s("span",Cs,[s("span",Ls,o(e.server.last_online_time),1)])])])]),s("div",Ps,[s("div",Es,[s("div",Ts,[s("div",Us,[Fs,s("span",Ns,"最后更新于："+o(e.server.server_state.update_time),1)]),s("div",Vs,[n(h,{type:"dashboard","stroke-width":20,width:200,striped:"","striped-flow":"",percentage:r.help.formatPercent(100,e.server.server_state.cpu),color:e.colors},null,8,["percentage","color"])]),s("div",Ds,[s("div",Js,[Ms,s("span",Os,o(e.server.server_state.load1.toFixed(2)),1)]),s("div",js,[Hs,s("span",Ks,o(e.server.server_state.load5.toFixed(2)),1)]),s("div",Ws,[qs,s("span",As,o(e.server.server_state.load15.toFixed(2)),1)])]),s("div",Gs,[s("div",Qs,[Rs,s("span",Xs,o(e.server.server_state.tcp_conn_count),1)]),s("div",Ys,[Zs,s("span",$s,o(e.server.server_state.udp_conn_count),1)]),s("div",se,[ee,s("span",te,o(e.server.server_state.process_count),1)])])])]),s("div",oe,[s("div",ce,[le,s("div",re,[n(h,{percentage:r.help.formatPercent(e.server.server_info.mem_total,e.server.server_state.mem_used),color:e.colors,striped:"","striped-flow":""},null,8,["percentage","color"])]),s("div",ie,[s("div",ne,[de,s("span",_e,o(r.help.formatByteSize(e.server.server_info.mem_total)),1)]),s("div",ae,[me,s("span",he,o(r.help.formatByteSize(e.server.server_state.mem_used)),1)]),s("div",ve,[pe,s("span",ue,o(r.help.formatByteSize(e.server.server_info.swap_total)),1)]),s("div",be,[ge,s("span",fe,o(r.help.formatByteSize(e.server.server_state.swap_used)),1)])])]),s("div",we,[xe,s("div",Se,[n(h,{percentage:r.help.formatPercent(e.server.server_info.disk_total,e.server.server_state.disk_used),format:()=>r.help.formatByteSize(e.server.server_state.disk_used)+"/"+r.help.formatByteSize(e.server.server_info.disk_total),color:e.colors,striped:"","striped-flow":""},null,8,["percentage","format","color"])])]),s("div",ye,[ke,s("div",Ie,[s("div",Be,[ze,s("span",Ce,o(r.help.formatByteSize(e.server.server_state.net_in_speed))+"/s ",1)]),s("div",Le,[Pe,s("span",Ee,o(r.help.formatByteSize(e.server.server_state.net_out_speed))+"/s ",1)]),s("div",Te,[Ue,s("span",Fe,o(r.help.formatByteSize(e.server.server_state.net_in_transfer)),1)]),s("div",Ne,[Ve,s("span",De,o(r.help.formatByteSize(e.server.server_state.net_out_transfer)),1)])])])])]),s("div",Je,[n(g,{"server-id":e.serverId,limit:5},null,8,["server-id"])])],64)):(_(),a("div",Me,[n(f,{description:"未安装"})]))])):k("",!0)}const Ge=w(V,[["render",Oe],["__scopeId","data-v-de77a4d9"]]);export{Ge as default};
