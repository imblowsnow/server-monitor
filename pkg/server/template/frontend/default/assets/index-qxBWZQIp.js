import{_ as x,G as v,u as S,o as d,c as _,a as s,t as l,F as y,b as n,w as k,H as B,I,J as z,h as L,p as P,f as C,K as E}from"./index-L-XxcENT.js";import{_ as p}from"./monitor-faults-Dtoc9cZQ.js";import{d as T,g as F,a as N}from"./server-CCX-AtOc.js";/* empty css                  */function u(o){if(!o)return"0B";var c=Math.floor(Math.log(o)/Math.log(1024)),i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];return parseFloat((o/Math.pow(1024,c)).toFixed(2))+i[c]}function M(o){const c=u(o);return c!="NaN undefined"?c:"0B"}function D(o,c){return parseInt(c/o*100)||0}const V={readableBytes:u,formatByteSize:M,formatPercent:D},J={computed:{help(){return V}},components:{MonitorFaults:p,ServerStatisticsBar:v},data(){return{settingStore:S(),total:[],server:null,serverId:null,serverStatisticsType:3,colors:[{color:"#5cb87a",percentage:50},{color:"#e6a23c",percentage:80},{color:"#f56c6c",percentage:100}],ws:null}},watch:{"$route.params.id"(){this.serverId=this.$route.params.id,this.getServerInfo(this.serverId),this.getServerStatisticsList(this.serverId),this.$bus.emit("serverSelect",this.serverId)}},mounted(){this.serverId=this.$route.params.id,this.getServerInfo(this.serverId),this.getServerStatisticsList(this.serverId),this.$bus.emit("serverSelect",this.serverId),this.registerServerListen()},unmounted(){if(this.$bus.emit("serverSelect",null),this.ws){let o=this.ws;this.ws=null,o.close()}},methods:{handleEdit(o){this.$router.push(`/server/edit/${o}`)},handleDelete(o){this.$confirm("此操作将永久删除该服务器, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{T(o).then(()=>{this.$message({type:"success",message:"删除成功!"}),this.$bus.emit("serverChanged"),this.$router.go(-1)}).catch(c=>{this.$message({type:"error",message:"删除失败!"+c})})}).catch(()=>{})},getServerInfo(o){F(o).then(c=>{this.server=c})},getServerStatisticsList(o){N(o,this.serverStatisticsType).then(c=>{this.total=c})},registerServerListen(){this.ws=new WebSocket("/ws/web"),this.ws.addEventListener("message",o=>{let c=JSON.parse(o.data),i=JSON.parse(c.message);console.log("Message from server ",c.message_type,i),c.message_type===5e3?i.server_id==this.serverId&&(this.server.status=1,this.server.server_info=i.server_info,this.server.server_state=i.server_state):c.message_type===5001?i==this.serverId&&(this.server.status=0):c.message_type===5002&&i.server_id==this.serverId&&(console.log("Server state update: ",i),this.server.server_state=i)}),this.ws.addEventListener("close",o=>{console.log("Server connection closed: ",o),this.ws!=null&&(this.$message({type:"error",message:"服务器连接已断开，正在重新链接!"}),setTimeout(()=>{this.registerServerListen()},1e3))})},copyInstallScript(){let o=this.settingStore.setting.server_ip,c=this.settingStore.setting.server_port,i=this.server.key,a=`curl https://cdn.jsdelivr.net/gh/imblowsnow/server-monitor@master/deploy.sh | bash -s -- ${o} ${c} ${i}`;console.log(a);let e=document.createElement("input");e.value=a,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.$message({type:"success",message:"复制成功!"})}}},t=o=>(P("data-v-ca448d52"),o=o(),C(),o),U={key:0,class:"server"},j={class:"mb-3"},G={class:"mb-3"},K={class:"functions mb-3"},O={class:"btn-group",role:"group"},H={class:"shadow-box mb-3"},W={class:"row"},Y={class:"col-md-8"},Z={class:"wrap",style:{padding:"7.5px 2.6px",width:"100%"}},q=t(()=>s("span",{class:"word"},"最近30天",-1)),A={class:"col-md-4 text-center"},Q={key:0,class:"badge rounded-pill bg-primary",style:{"font-size":"30px"}},R={key:1,class:"badge rounded-pill bg-danger",style:{"font-size":"30px"}},X={class:"shadow-box big-padding text-center stats mb-3"},$={class:"row"},ss={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},es=t(()=>s("h4",{class:"col-4 col-sm-12"},"IP",-1)),ts=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," 当前 ",-1)),os={class:"col-4 col-sm-12 num"},cs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ls=t(()=>s("h4",{class:"col-4 col-sm-12"},"系统",-1)),rs=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," os ",-1)),is={class:"col-4 col-sm-12 num"},ns={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ds=t(()=>s("h4",{class:"col-4 col-sm-12"},"系统型号",-1)),_s=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," platform ",-1)),as={class:"col-4 col-sm-12 num"},ms={class:"shadow-box big-padding text-center stats mb-3"},hs={class:"row"},vs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ps=t(()=>s("h4",{class:"col-4 col-sm-12"},"CPU型号",-1)),us=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," cpu ",-1)),fs={class:"col-4 col-sm-12 num"},gs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},bs=t(()=>s("h4",{class:"col-4 col-sm-12"},"虚拟化",-1)),ws=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," virtualization ",-1)),xs={class:"col-4 col-sm-12 num"},Ss={class:""},ys={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ks=t(()=>s("h4",{class:"col-4 col-sm-12"},"最后在线时间",-1)),Bs=t(()=>s("p",{class:"col-4 col-sm-12 mb-0 mb-sm-2"}," Last online ",-1)),Is={class:"col-4 col-sm-12 num"},zs={class:""},Ls={class:"row"},Ps={class:"col-md-6"},Cs={class:"shadow-box mb-3"},Es={style:{display:"flex","justify-content":"space-between"}},Ts=t(()=>s("h4",{class:"mb-3"},"CPU Load",-1)),Fs={class:"desc"},Ns={class:"text-center mb-5"},Ms={class:"row mb-3"},Ds={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Vs=t(()=>s("div",{class:"col-6 col-sm-12"},"Load1",-1)),Js={class:"col-6 col-sm-12 num desc"},Us={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},js=t(()=>s("div",{class:"col-6 col-sm-12"},"Load5",-1)),Gs={class:"col-6 col-sm-12 num desc"},Ks={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Os=t(()=>s("div",{class:"col-6 col-sm-12"},"Load15",-1)),Hs={class:"col-6 col-sm-12 num desc"},Ws={class:"row"},Ys={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Zs=t(()=>s("div",{class:"col-6 col-sm-12"},"TCP连接数",-1)),qs={class:"col-6 col-sm-12 num desc"},As={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Qs=t(()=>s("div",{class:"col-6 col-sm-12"},"UDP连接数",-1)),Rs={class:"col-6 col-sm-12 num desc"},Xs={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},$s=t(()=>s("div",{class:"col-6 col-sm-12"},"进程数",-1)),se={class:"col-6 col-sm-12 num desc"},ee={class:"col-md-6"},te={class:"shadow-box mb-3"},oe=t(()=>s("h4",{class:"mb-3"},"内存",-1)),ce={class:"mb-3"},le={class:"row"},re={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ie=t(()=>s("div",{class:"col-6 col-sm-12"},"内存大小",-1)),ne={class:"col-6 col-sm-12 num desc"},de={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},_e=t(()=>s("div",{class:"col-6 col-sm-12"},"内存占用",-1)),ae={class:"col-6 col-sm-12 num desc"},me={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},he=t(()=>s("div",{class:"col-6 col-sm-12"},"交换分区大小",-1)),ve={class:"col-6 col-sm-12 num desc"},pe={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},ue=t(()=>s("div",{class:"col-6 col-sm-12"},"交换分区占用",-1)),fe={class:"col-6 col-sm-12 num desc"},ge={class:"shadow-box mb-3"},be=t(()=>s("h4",{class:"mb-3"},"磁盘",-1)),we={class:"mb-3"},xe={class:"shadow-box mb-3"},Se=t(()=>s("h4",{class:"mb-3"},"网络",-1)),ye={class:"row"},ke={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Be=t(()=>s("div",{class:"col-6 col-sm-12"},"入站速度",-1)),Ie={class:"col-6 col-sm-12 desc"},ze={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Le=t(()=>s("div",{class:"col-6 col-sm-12"},"出站速度",-1)),Pe={class:"col-6 col-sm-12 desc"},Ce={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ee=t(()=>s("div",{class:"col-6 col-sm-12"},"入站流量",-1)),Te={class:"col-6 col-sm-12 desc"},Fe={class:"col-12 col-sm col row d-flex align-items-center d-sm-block"},Ne=t(()=>s("div",{class:"col-6 col-sm-12"},"出站流量",-1)),Me={class:"col-6 col-sm-12 desc"},De={class:"shadow-box mb-3"},Ve={key:1,class:"shadow-box"};function Je(o,c,i,a,e,r){const f=v,g=I,m=z,b=p,w=E;return e.server?(d(),_("div",U,[s("h1",j,l(e.server.name),1),s("div",G,l(e.server.remark),1),s("div",K,[s("div",O,[s("button",{class:"btn btn-primary",onClick:c[0]||(c[0]=h=>r.handleEdit(e.server.id))}," 编辑 "),s("button",{class:"btn btn-primary",onClick:c[1]||(c[1]=(...h)=>r.copyInstallScript&&r.copyInstallScript(...h))}," 安装脚本 "),s("button",{class:"btn btn-danger",onClick:c[2]||(c[2]=h=>r.handleDelete(e.server.id))}," 删除 ")])]),e.server.server_info?(d(),_(y,{key:0},[s("div",H,[s("div",W,[s("div",Y,[s("div",Z,[n(f,{width:10,height:30,total:e.total},null,8,["total"])]),q]),s("div",A,[e.server.status===1?(d(),_("span",Q," 在线 ")):(d(),_("span",R," 离线 "))])])]),s("div",X,[s("div",$,[s("div",ss,[es,ts,s("span",os,l(e.server.ip),1)]),s("div",cs,[ls,rs,s("span",is,l(e.server.server_info.os),1)]),s("div",ns,[ds,_s,s("span",as,l(e.server.server_info.platform),1)])])]),s("div",ms,[s("div",hs,[s("div",vs,[ps,us,s("span",fs,[n(g,{"line-clamp":"1",title:e.server.server_info.cpu},{default:k(()=>[L(l(e.server.server_info.cpu),1)]),_:1},8,["title"])])]),s("div",gs,[bs,ws,s("span",xs,[s("span",Ss,l(e.server.server_info.virtualization),1)])]),s("div",ys,[ks,Bs,s("span",Is,[s("span",zs,l(e.server.last_online_time),1)])])])]),s("div",Ls,[s("div",Ps,[s("div",Cs,[s("div",Es,[Ts,s("span",Fs,"最后更新于："+l(e.server.server_state.update_time),1)]),s("div",Ns,[n(m,{type:"dashboard","stroke-width":20,width:200,striped:"","striped-flow":"",percentage:r.help.formatPercent(100,e.server.server_state.cpu),color:e.colors},null,8,["percentage","color"])]),s("div",Ms,[s("div",Ds,[Vs,s("span",Js,l(e.server.server_state.load1.toFixed(2)),1)]),s("div",Us,[js,s("span",Gs,l(e.server.server_state.load5.toFixed(2)),1)]),s("div",Ks,[Os,s("span",Hs,l(e.server.server_state.load15.toFixed(2)),1)])]),s("div",Ws,[s("div",Ys,[Zs,s("span",qs,l(e.server.server_state.tcp_conn_count),1)]),s("div",As,[Qs,s("span",Rs,l(e.server.server_state.udp_conn_count),1)]),s("div",Xs,[$s,s("span",se,l(e.server.server_state.process_count),1)])])])]),s("div",ee,[s("div",te,[oe,s("div",ce,[n(m,{percentage:r.help.formatPercent(e.server.server_info.mem_total,e.server.server_state.mem_used),color:e.colors,striped:"","striped-flow":""},null,8,["percentage","color"])]),s("div",le,[s("div",re,[ie,s("span",ne,l(r.help.formatByteSize(e.server.server_info.mem_total)),1)]),s("div",de,[_e,s("span",ae,l(r.help.formatByteSize(e.server.server_state.mem_used)),1)]),s("div",me,[he,s("span",ve,l(r.help.formatByteSize(e.server.server_info.swap_total)),1)]),s("div",pe,[ue,s("span",fe,l(r.help.formatByteSize(e.server.server_state.swap_used)),1)])])]),s("div",ge,[be,s("div",we,[n(m,{percentage:r.help.formatPercent(e.server.server_info.disk_total,e.server.server_state.disk_used),format:()=>r.help.formatByteSize(e.server.server_state.disk_used)+"/"+r.help.formatByteSize(e.server.server_info.disk_total),color:e.colors,striped:"","striped-flow":""},null,8,["percentage","format","color"])])]),s("div",xe,[Se,s("div",ye,[s("div",ke,[Be,s("span",Ie,l(r.help.formatByteSize(e.server.server_state.net_in_speed))+"/s ",1)]),s("div",ze,[Le,s("span",Pe,l(r.help.formatByteSize(e.server.server_state.net_out_speed))+"/s ",1)]),s("div",Ce,[Ee,s("span",Te,l(r.help.formatByteSize(e.server.server_state.net_in_transfer)),1)]),s("div",Fe,[Ne,s("span",Me,l(r.help.formatByteSize(e.server.server_state.net_out_transfer)),1)])])])])]),s("div",De,[n(b,{"server-id":e.serverId,limit:5},null,8,["server-id"])])],64)):(d(),_("div",Ve,[n(w,{description:"未安装"})]))])):B("",!0)}const Oe=x(J,[["render",Je],["__scopeId","data-v-ca448d52"]]);export{Oe as default};
